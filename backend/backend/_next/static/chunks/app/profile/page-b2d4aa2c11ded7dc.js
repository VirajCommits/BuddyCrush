(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[636],{2804:(e,t,o)=>{Promise.resolve().then(o.bind(o,3884))},3884:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>y});var r=o(5155),a=o(2115),i=o(2651),s=o(5565);function n(e){let{leaderboard:t}=e;return 0===t.length?(0,r.jsx)("p",{style:l.noData,children:"No completions yet."}):(0,r.jsx)("div",{style:l.container,children:(0,r.jsx)("ol",{style:l.list,children:t.map(e=>(0,r.jsxs)("li",{style:l.listItem,children:[(0,r.jsx)(s.default,{src:e.user_picture||"https://via.placeholder.com/40",alt:"".concat(e.user_name,"'s avatar"),width:40,height:40,style:l.avatar}),(0,r.jsxs)("div",{style:l.userInfo,children:[(0,r.jsx)("span",{style:l.userName,children:e.user_name}),(0,r.jsxs)("span",{style:l.completionCount,children:[e.completion_count," completions"]})]})]},e.user_id))})})}let l={container:{padding:"1px",borderRadius:"8px",maxWidth:"500px"},noData:{color:"#ddd",textAlign:"center",fontSize:"14px"},list:{listStyleType:"decimal",paddingLeft:"3px",margin:"0"},listItem:{display:"flex",alignItems:"center",padding:"5px 0"},avatar:{width:"40px",height:"40px",borderRadius:"50%",marginRight:"15px",objectFit:"cover",border:"2px solid #444"},userInfo:{display:"flex",flexDirection:"column",flex:1},userName:{fontWeight:"600",fontSize:"14px",color:"#fff",marginBottom:"5px"},completionCount:{fontSize:"12px",color:"#aaa"}};function d(e){let{activity:t=[]}=e;return Array.isArray(t)&&0!==t.length?(0,r.jsx)("div",{style:c.container,children:(0,r.jsx)("ul",{style:c.list,children:t.map((e,t)=>(0,r.jsxs)("li",{style:c.listItem,children:[(0,r.jsx)(s.default,{src:e.user_picture||"https://via.placeholder.com/40",alt:"".concat(e.user_name,"'s avatar"),width:40,height:40,style:c.avatar}),(0,r.jsxs)("div",{style:c.userInfo,children:[(0,r.jsx)("span",{style:c.userName,children:e.user_name}),(0,r.jsxs)("span",{style:c.completed,children:["Completed"," ",e.days_ago>0?"".concat(e.days_ago," day(s) ago"):"today"]})]})]},t))})}):(0,r.jsx)("p",{style:c.noData,children:"No recent activity."})}let c={container:{borderRadius:"8px",maxWidth:"1000px",margin:"20px auto"},noData:{color:"#ddd",textAlign:"center",fontSize:"14px"},list:{listStyleType:"none",padding:"0",margin:"0"},listItem:{display:"flex",alignItems:"center",padding:"10px"},avatar:{borderRadius:"50%",objectFit:"cover",marginRight:"10px",border:"2px solid #444"},userInfo:{display:"flex",flexDirection:"column"},userName:{fontWeight:"600",fontSize:"14px",color:"#fff",marginBottom:"3px"},completed:{fontSize:"12px",color:"#aaa"}};var p=o(1536),u=o(5370);let x=(0,o(1319).io)("http://127.0.0.1:5000",{withCredentials:!0,transports:["websocket"],reconnectionAttempts:5});function g(e){let{groupId:t,onClose:o}=e,[i,n]=(0,a.useState)([]),[l,d]=(0,a.useState)("");(0,a.useEffect)(()=>{x.emit("join_group",{group_id:t});let e=e=>{n(t=>[...t,e])};return x.on("group_message",e),()=>{x.emit("leave_group",{group_id:t}),x.off("group_message",e)}},[t]),(0,a.useEffect)(()=>{(async()=>{let e=await fetch("/api/groups/".concat(t,"/messages"),{credentials:"include"});e.ok&&n((await e.json()).messages||[])})()},[t]);let c=async()=>{l.trim()&&(await fetch("/api/groups/".concat(t,"/send-message"),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({message:l})}),d(""))};return(0,r.jsxs)("div",{style:m.container,children:[(0,r.jsxs)("div",{style:m.header,children:[(0,r.jsx)("button",{onClick:o,style:m.closeBtn,children:"X"}),(0,r.jsx)("p",{style:{margin:0},children:"Group Chat"})]}),(0,r.jsx)("div",{style:m.messagesArea,children:i.map((e,t)=>(0,r.jsxs)("div",{style:m.messageRow,children:[(0,r.jsx)(s.default,{src:e.user_image||"...",width:30,height:30,alt:"avatar"}),(0,r.jsx)("div",{style:m.bubble,children:e.message})]},t))}),(0,r.jsxs)("div",{style:m.inputRow,children:[(0,r.jsx)("input",{style:m.input,value:l,onChange:e=>d(e.target.value)}),(0,r.jsx)("button",{style:m.sendBtn,onClick:c,children:"Send"})]})]})}let m={container:{height:"250px",display:"flex",flexDirection:"column",fontSize:"14px",backgroundColor:"#1e1e2f",borderRadius:8,overflow:"hidden"},header:{display:"flex",justifyContent:"space-between",backgroundColor:"#2a2a3b",padding:"6px 10px"},closeBtn:{cursor:"pointer",color:"#fff",border:"none",background:"none"},messagesArea:{flex:1,overflowY:"auto",padding:"8px"},messageRow:{display:"flex",alignItems:"center",marginBottom:"6px"},bubble:{marginLeft:8,backgroundColor:"#2e3a4b",color:"#fff",padding:"6px 10px",borderRadius:12,maxWidth:"70%"},inputRow:{display:"flex",gap:6,padding:8,backgroundColor:"#2a2a3b"},input:{flex:1,borderRadius:4,border:"1px solid #444",backgroundColor:"#2e3a4b",color:"#fff",padding:"6px"},sendBtn:{backgroundColor:"#007bff",color:"#fff",border:"none",borderRadius:4,padding:"6px 12px",cursor:"pointer"}};function h(e){let{group:t}=e,[o,i]=(0,a.useState)("activity"),[l,c]=(0,a.useState)(!1),[x,m]=(0,a.useState)(""),[h,b]=(0,a.useState)(!1),[y,v]=(0,a.useState)([]),[j,C]=(0,a.useState)([]),[w,B]=(0,a.useState)(!1);(0,a.useEffect)(()=>{(async()=>{try{let e=await (0,u.QY)(t.id),o=(await (0,u.eO)()).data.user,r=new Date().toISOString().split("T")[0],a=e.data.activity.some(e=>e.completed_date===r&&e.user_email===o.email);c(a),C(e.data.activity)}catch(e){console.error("Error checking completion:",e),m("Failed to verify task completion.")}})()},[t.id]),(0,a.useEffect)(()=>{(async()=>{try{let e=await (0,u.kK)(t.id);v(e.data.leaderboard)}catch(e){console.error("Error fetching leaderboard:",e),m("Failed to fetch leaderboard.")}})()},[t.id]);let S=async()=>{b(!0);try{let e=await (0,u.Kr)(t.id);console.log("Completed data:",e);let o=e.data.user_email;alert(e.message||"Habit completed successfully!"),c(!0),C(e=>{var r;return[...e,{user_picture:null===(r=t.members.find(e=>e.email===o))||void 0===r?void 0:r.user_image,completed_date:new Date().toISOString().split("T")[0],days_ago:0}]}),v(t=>t.map(t=>t.user_email===e.user_email?{...t,completion_count:t.completion_count+1}:t))}catch(t){var e,o;console.error("Error completing habit:",t),m((null===(o=t.response)||void 0===o?void 0:null===(e=o.data)||void 0===e?void 0:e.error)||"Failed to complete the daily task.")}finally{b(!1)}};return(0,r.jsxs)("div",{style:f.card,children:[(0,r.jsx)("div",{style:f.topHeader,children:(0,r.jsx)("h3",{style:f.groupName,children:t.name})}),(0,r.jsxs)("div",{style:f.header,children:[(0,r.jsxs)("div",{style:f.tabs,children:[(0,r.jsx)("button",{style:{...f.tabButton,..."activity"===o?f.activeTab:{}},onClick:()=>i("activity"),children:"Activity"}),(0,r.jsx)("button",{style:{...f.tabButton,..."leaderboard"===o?f.activeTab:{}},onClick:()=>i("leaderboard"),children:"Leaderboard"}),(0,r.jsx)("button",{style:{...f.tabButton,..."about"===o?f.activeTab:{}},onClick:()=>i("about"),children:"About"})]}),(0,r.jsx)(p.uN,{style:f.chatIcon,title:"Open Chat",onClick:()=>{B(!0)}})]}),(0,r.jsxs)("div",{style:f.content,children:["activity"===o&&(0,r.jsx)(d,{activity:j}),"leaderboard"===o&&(0,r.jsx)(n,{leaderboard:y}),"about"===o&&(0,r.jsxs)("div",{style:f.about,children:[(0,r.jsx)("p",{style:f.description,children:t.description}),(0,r.jsxs)("p",{style:f.totalMembers,children:[t.members.length," members"]}),(0,r.jsx)("div",{style:f.membersList,children:t.members.map(e=>(0,r.jsxs)("div",{style:f.member,children:[(0,r.jsx)(s.default,{src:e.user_image||"https://via.placeholder.com/30",alt:"".concat(e.name,"'s avatar"),width:30,height:30,style:f.memberAvatar,onError:e=>{e.target.src="https://via.placeholder.com/30"}}),(0,r.jsx)("span",{style:f.memberName,children:e.name})]},e.email))})]})]}),x&&(0,r.jsx)("div",{style:f.error,children:x}),(0,r.jsx)("button",{onClick:S,style:{...f.completeButton,...l?f.completedButton:{}},disabled:l||h,children:l?"Completed Today \uD83C\uDF89":h?"Completing\uD83D\uDE80":"Complete Habit \uD83D\uDE80\uD83D\uDE80"}),w&&(0,r.jsx)(g,{groupId:t.id,onClose:()=>{B(!1)}})]})}let f={topHeader:{marginBottom:"20px"},card:{backgroundColor:"#1c1c1c",borderRadius:"10px",padding:"20px",boxShadow:"0 4px 8px rgba(0,0,0,0.3)",display:"flex",flexDirection:"column",justifyContent:"space-between",minHeight:"500px"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},groupName:{margin:0,color:"#fff"},tabs:{display:"flex",gap:"10px"},tabButton:{padding:"5px 10px",backgroundColor:"#2c2c2c",color:"#fff",border:"none",borderRadius:"5px",cursor:"pointer",fontSize:"0.9rem",transition:"background-color 0.3s"},activeTab:{backgroundColor:"#007bff"},content:{flex:1,marginBottom:"10px",overflowY:"auto",maxHeight:"350px"},about:{padding:"10px",backgroundColor:"#2c2c3b",borderRadius:"5px"},description:{marginBottom:"10px",color:"#ccc"},totalMembers:{marginBottom:"10px",color:"#ccc",fontWeight:"bold"},membersList:{display:"flex",flexWrap:"wrap",gap:"10px"},member:{display:"flex",alignItems:"center",backgroundColor:"#3c3c3c",padding:"5px 10px",borderRadius:"5px"},memberAvatar:{width:"30px",height:"30px",borderRadius:"50%",objectFit:"cover",marginRight:"8px"},memberName:{color:"#fff",fontSize:"0.9rem"},chatIcon:{color:"#007bff",fontSize:"20px",cursor:"pointer",transition:"color 0.3s"},completeButton:{padding:"10px",backgroundColor:"#28a745",color:"#fff",border:"none",borderRadius:"5px",cursor:"pointer",fontWeight:"bold",marginTop:"10px",transition:"background-color 0.3s"},completedButton:{backgroundColor:"#6c757d",cursor:"not-allowed"},error:{color:"red",marginBottom:"10px"}};var b=o(6046);function y(){let[e,t]=(0,a.useState)(null),[o,n]=(0,a.useState)([]),[l,d]=(0,a.useState)(!0),[c,p]=(0,a.useState)(""),u=(0,b.useRouter)();(0,a.useEffect)(()=>{(async()=>{try{let e=await i.A.get("/api/profile",{withCredentials:!0});console.log("This is the response i get:",e.data.user.picture),t(e.data.user)}catch(t){var e,o;p((null===(o=t.response)||void 0===o?void 0:null===(e=o.data)||void 0===e?void 0:e.error)||"Failed to fetch profile")}})()},[]),(0,a.useEffect)(()=>{(async()=>{if(e)try{let t=((await i.A.get("/api/groups/discover",{withCredentials:!0})).data.groups||[]).filter(t=>t.members.some(t=>t.email===e.email));n(t)}catch(e){console.error("Error fetching groups:",e)}})()},[e]),(0,a.useEffect)(()=>{if(e){let t=new Image;setTimeout(()=>{t.src=e.picture,console.log(t.src)},300),t.onload=()=>d(!1),t.onerror=()=>{console.error("Error loading image"),d(!1)}}},[e]);let x=async()=>{try{await i.A.post("/api/logout",{},{withCredentials:!0}),u.push("/")}catch(e){console.error("Logout failed:",e),alert("Logout failed, see console for details.")}};return l?(0,r.jsx)("div",{style:v.loading,children:"Loading profile..."}):c?(0,r.jsxs)("div",{style:v.errorMsg,children:["Error: ",c]}):(0,r.jsxs)("div",{style:v.pageWrapper,children:[(0,r.jsxs)("header",{style:v.header,children:[(0,r.jsx)("div",{style:v.logoArea,children:(0,r.jsx)("h1",{style:v.logoText,children:"Buddy Board"})}),(0,r.jsx)("div",{style:v.userArea,children:(0,r.jsx)(s.default,{src:(null==e?void 0:e.picture)||"https://via.placeholder.com/50",alt:"".concat(null==e?void 0:e.name,"'s avatar"),width:50,height:50,style:v.userAvatar,onClick:x,title:"Logout"})})]}),(0,r.jsxs)("div",{style:v.container,children:[(0,r.jsxs)("section",{style:v.profileCard,children:[(0,r.jsxs)("h2",{style:v.welcomeText,children:["Welcome, ",null==e?void 0:e.name,"!"]}),(0,r.jsx)(s.default,{src:(null==e?void 0:e.picture)||"https://via.placeholder.com/140",alt:"".concat(null==e?void 0:e.name,"'s avatar"),width:140,height:140,style:v.avatar}),(0,r.jsxs)("p",{style:v.emailText,children:["Email: ",null==e?void 0:e.email]}),(0,r.jsx)("button",{onClick:x,style:v.logoutButton,children:"Log Out"})]}),(0,r.jsxs)("section",{style:v.cardGrid,children:[(0,r.jsxs)("div",{style:v.card,children:[(0,r.jsx)("h3",{style:v.cardTitle,children:"Create Group"}),(0,r.jsx)("p",{style:v.cardDesc,children:"Start a new accountability group to track your habits together!"}),(0,r.jsx)("a",{href:"/new",style:v.actionButton,children:"Create Group"})]}),(0,r.jsxs)("div",{style:v.card,children:[(0,r.jsx)("h3",{style:v.cardTitle,children:"Discover Groups"}),(0,r.jsx)("p",{style:v.cardDesc,children:"Join existing groups and find new buddies to crush your goals."}),(0,r.jsx)("a",{href:"/discover",style:v.actionButton,children:"Discover Groups"})]})]}),(0,r.jsxs)("section",{style:v.groupsSection,children:[(0,r.jsx)("h2",{style:v.subheading,children:"Your Joined Groups"}),0===o.length?(0,r.jsx)("p",{style:v.noGroupsText,children:"You have not joined any groups."}):(0,r.jsx)("div",{style:v.groupsGrid,children:o.map(e=>(0,r.jsx)(h,{group:e},e.id))})]})]})]})}let v={errorMsg:{color:"red",textAlign:"center",marginTop:"50px"},loading:{color:"#fff",textAlign:"center",marginTop:"50px",fontFamily:"sans-serif",fontSize:"16px"},pageWrapper:{minHeight:"100vh",backgroundColor:"#1A1A1D",color:"#EAEAEA",display:"flex",flexDirection:"column",fontFamily:"'Roboto', sans-serif"},header:{backgroundColor:"#29293D",display:"flex",alignItems:"center",justifyContent:"space-between",padding:"20px 30px",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.3)"},logoArea:{},logoText:{fontSize:"1.8rem",fontWeight:"bold",color:"#FFFFFF",margin:0},userArea:{display:"flex",alignItems:"center"},userAvatar:{width:"50px",height:"50px",borderRadius:"50%",objectFit:"cover",border:"2px solid #555",cursor:"pointer",transition:"transform 0.3s, box-shadow 0.3s"},container:{flex:1,maxWidth:"1100px",margin:"40px auto",padding:"20px",display:"flex",flexDirection:"column",gap:"30px"},profileCard:{backgroundColor:"#2A2A40",borderRadius:"12px",padding:"30px",textAlign:"center",boxShadow:"0 6px 12px rgba(0,0,0,0.3)",color:"#EAEAEA"},welcomeText:{fontSize:"2rem",marginBottom:"20px",fontWeight:"bold"},avatar:{width:"140px",height:"140px",borderRadius:"50%",margin:"20px 0",objectFit:"cover",border:"3px solid #444"},emailText:{margin:"10px 0 20px 0",color:"#BBBBBB"},logoutButton:{padding:"12px 24px",backgroundColor:"#FF4B5C",color:"#FFFFFF",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"bold",transition:"background-color 0.3s ease"},cardGrid:{display:"flex",flexWrap:"wrap",gap:"20px",justifyContent:"center"},card:{backgroundColor:"#2A2A40",borderRadius:"12px",padding:"20px",textAlign:"center",boxShadow:"0 6px 12px rgba(0,0,0,0.3)",display:"flex",flexDirection:"column",justifyContent:"space-between",gap:"10px",flex:"1 1 280px",maxWidth:"300px"},cardTitle:{fontSize:"1.5rem",fontWeight:"bold",marginBottom:"10px",color:"#FFFFFF"},cardDesc:{color:"#BBBBBB",marginBottom:"15px",fontSize:"14px"},actionButton:{padding:"12px 20px",backgroundColor:"#007BFF",color:"#FFFFFF",borderRadius:"8px",textDecoration:"none",fontWeight:"bold",transition:"background-color 0.3s ease",textAlign:"center",cursor:"pointer"},groupsSection:{marginTop:"30px"},subheading:{fontSize:"1.8rem",marginBottom:"20px",fontWeight:"bold",textAlign:"center"},noGroupsText:{color:"#BBBBBB",textAlign:"center",fontSize:"14px"},groupsGrid:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:"20px"}}},5370:(e,t,o)=>{"use strict";o.d(t,{Kr:()=>n,QY:()=>d,U7:()=>s,eO:()=>a,kK:()=>l,pl:()=>i});let r=o(2651).A.create({baseURL:"http://127.0.0.1:5000/api",withCredentials:!0}),a=()=>r.get("/profile"),i=()=>r.get("/groups/discover"),s=e=>r.post("/groups/".concat(e,"/join")),n=e=>r.post("/groups/".concat(e,"/complete")),l=e=>r.get("/groups/".concat(e,"/leaderboard")),d=e=>r.get("/groups/".concat(e,"/activity"))}},e=>{var t=t=>e(e.s=t);e.O(0,[711,651,303,976,441,517,358],()=>t(2804)),_N_E=e.O()}]);